---
  - name: Deploy Dev environment on VMware
    hosts: localhost
    connection: local
    gather_facts: false

 # include vars file
    vars_files:
      - group_vars/vmdev_vmw_vars.yml

    tasks:
  # Create specific Port Group on vSwitch or DvSwitch



  # Create a VM from a template
  - name: create the VMs
    local_action:
      module: vmware_guest
      datacenter: "{{ vmw_datacenter }}"
      cluster: "{{ vmw_cluster }}"
      resource_pool: "{{ vmw_resourcepool|default(omit, true) }}"
      folder: "/{{ vmw_folder }}/{{ vmw_environment }}"
      name: "{{ customer }}-{{ vmw_environment }}-{{ item.name }}"
      template: "{{ item.vmw_templates }}"
      state: poweredon
      guest_id: "{{ vmw_os_type }}"
      annotation: "{{ vmw_server_role }} - {{ vmw_environment }}"
      disk:
      - size_gb: "{{ vmw_disk_size }}"
        type: thin
        datastore: '{{ vmw_datastore }}'
      networks:
      - name: server_network
        ip: "{{ custom_ip }}"
        netmask: "{{Â netmask }}"
        gateway: "{{ gateway }}"
        dns_servers:
        - "{{ dns_server1 }}"
        - "{{ dns_server2 }}"
      hardware:
        memory_mb: "{{ vmw_mem }}"
        num_cpus: "{{ vmw_cpu }}"
      customization:
        dns_servers:
        - "{{ dns_server1 }}"
        - "{{ dns_server2 }}"
        domain : "{{ domain }}"
        hostname: "{{ customer }}-{{ environment }}-{{ item.name }}"
      wait_for_ip_address: yes
    with-items: "{{ instances }}"
    register: newvm
